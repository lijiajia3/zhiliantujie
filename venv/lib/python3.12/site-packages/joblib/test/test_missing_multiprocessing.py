

import os
import subprocess
import sys


def test_missing_multiprocessing(tmp_path):
    
    (tmp_path / "_multiprocessing.py").write_text(
        'raise ImportError("No _multiprocessing module!")'
    )
    env = dict(os.environ)
    
    
    env["PYTHONPATH"] = ":".join([str(tmp_path)] + sys.path)
    subprocess.check_call(
        [sys.executable, "-c",
         "import joblib, math; "
         "joblib.Parallel(n_jobs=1)("
         "joblib.delayed(math.sqrt)(i**2) for i in range(10))"
         ], env=env)
